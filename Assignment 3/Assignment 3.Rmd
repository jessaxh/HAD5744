---
title: "Assignment 3"
author: "Husayn Jessa and Aidan Bodner"
date: "16/11/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load Packages
```{r Packages}
library(here)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(ggrepel)
library(ggtext)
library(showtext)
library(stringr)
library(fastDummies)
library(modelsummary)
```

# Data and Cleaning
```{r Data and Cleaning}
name <- Sys.info() 
name[7]

assign_data <- read.csv("a3_p1_sourdough_trends.csv")

```

# Question 1a
```{r Question 1a}

assign_data$date <- str_replace_all(assign_data$date, "T00:00:00Z", "")
assign_data$date <- as.factor(assign_data$date)
assign_data$date <- as.numeric(assign_data$date) #idk if we should do this

q1_line_graph <- ggplot(assign_data, (aes(x = date, y = hits, group = keyword))) + 
  geom_line(aes(color = keyword)) + theme_linedraw() + labs(x = "Date", y = "Hits") +
  geom_vline(xintercept = as.numeric(assign_data$date[75]), 
    color = "red") + geom_text(aes(x = as.numeric(date[120]), label="Start of Pandemic (2020-03-15)", y=90), color = "red") +
  scale_x_discrete(breaks = c("2020-01-01",
                              "2020-02-01",
                              "2020-03-01",
                              "2020-04-01",
                              "2020-05-01",
                              "2020-06-01",
                              "2020-07-01",
                              "2020-08-01"), labels = waiver())

q1_line_graph


#I wanted to make a line graph without converting our dates to numeric:
assign_data$date <- str_replace_all(assign_data$date, "T00:00:00Z", "")

hq1_line_graph <- ggplot(assign_data, aes(x = date, y = hits, colour = keyword, group = keyword)) +
                theme_classic()  + geom_vline(xintercept = assign_data$date[75], show.legend = FALSE) + annotate("text", x=assign_data$date[70], y=86, label="Start of Pandemic ", angle=90) + geom_line() +  scale_x_discrete(breaks = c("2020-01-01",
                              "2020-02-01",
                              "2020-03-01",
                              "2020-04-01",
                              "2020-05-01",
                              "2020-06-01",
                              "2020-07-01",
                              "2020-08-01")) + ggtitle("Interest in Food Types Over Time")

hq1_line_graph

# Look at plot at pre-treatment, to gauge trend lines and similarities or differences: 

hq1_line_graph + coord_cartesian(xlim= c(0,76))
#we can see before the start of the pandemic sourdough looked similar to cereal but did not look anything like soup or sandwich so considering droping thos



```



# Question 1b
```{r Question 1b}

#Create Treated Variable for sourdough https://www.princeton.edu/~otorres/DID101R.pdf

regdata <- assign_data %>% mutate(treated = ifelse(keyword == "sourdough", 1, 0)) 

# Create a dummy variable to indicate the time when the treatment started. 

regdata <- regdata %>% mutate(pandemic_begun = ifelse(date >= "2020-03-15", 1, 0))

#Create interaction variable between treated and beginning of pandemic

regdata <- regdata %>% mutate(interaction = treated*pandemic_begun)

# Statistical tests: are the two groups' trends different?
pretrend_test <- lm(hits ~ treated + pandemic_begun + interaction, data=regdata)
msummary(list(pretrend_test),
         vcov=c(rep("robust",1)),
         stars=c('*' = .1, '**' = .05, '***' = .01)) # Interpret each coefficient here

#Dropping Control Groups

new_regdata<- regdata %>% filter(keyword %in% c("sourdough","cereal"))

unique(new_regdata$keyword)

new_pretrend_test <- lm(hits ~ treated + pandemic_begun + interaction, data=new_regdata)
msummary(list(pretrend_test,new_pretrend_test),
         vcov=c(rep("robust",1)),
         stars=c('*' = .1, '**' = .05, '***' = .01)) # Interpret each coefficient here

#i think this is how you do it but im not sure


```

# Question 1c
```{r Question 1c}

```

# Question 1d
```{r Question 1d}

```




