---
name: Husayn Jessa and Aidan Bodner
title: "Assignment 1"
output: html_document
date: '2022-09-30'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Assignment Intro}

name <- Sys.info()
name[7]

### Load the packages we will need for this file ####

library(tidyverse) # load the installed package for each new session of R
library(broom) # helps for storing regression output
library(here) # for file organization
library(modelsummary) # For making regression tables
library(dagitty) # for creating DAGs
library(psych)
library(RCurl)

# enter file path identifiers
here("Desktop", "Graduate Studies", "4. Courses", "Fall 2022", "HAD5744H", "Assignments", "Assignment 1")

assign_data <- read.csv("Dataset 1.csv") # assign data to an object

```

```{r Clean Data}

# Scan through dataframe to see variable class types
for(values in names(assign_data)){
  print(names(assign_data[values]))
  name <- names(assign_data[values])
  print(class(assign_data[,values]))
}

# Convert all to character
assign_data[, 1:19] <- lapply(assign_data[, 1:19], as.character)

# Assign the NAs in dataset to NA
assign_data <- mutate_at(.tbl = assign_data, 
                                .vars = vars(Country:PctPop65Pl2005), 
                                .funs = ~case_when(. == "#N/A" ~ NA_character_,
                                                   . == "-" ~ NA_character_,
                                                   TRUE ~ .,
                                                   TRUE ~ as.character(NA_character_)))

# Save cleaned data
write.csv(assign_data, "Dataset 1_Clean.csv", row.names = FALSE)

# Read in cleaned data
Dataset1 <- read.csv("Dataset 1_Clean.csv")

# Convert to numerics (aside from Country)
Dataset1[, 2:19] <- lapply(Dataset1[, 2:19], as.numeric)
```



Goal of assignment: To understand country differences in the life expectancy at birth for females

Question 1: Draw a preliminary DAG for the following variables: LEBF, GDPPC
 HXPC, total fertility rate, and any other covarites of relevance;ensure
relationships between the other independent variables is included
```{r Question No.1}

```


Question 2: What does your DAG tell you about interpreting any regression coefficients
causally 
```{r Question No.2}

```

Question 3: Make a table providing summary statistics for your variables;
table should include the mean, standard deviation and sample size for each variable
```{r summary table}
describe(Dataset1)
summary_table <- describe(Dataset1[ ,c("LEBF20052","maxINFM20052","GDPPCUS2005", "HXPC2005","PctHXPUB2005",
                   "TotFertRate2005","AdolFertRt2005","FtoMPrimaryEnrl2005ONY",
                   "PctUrb2005", "Sanitation2005ONY","ImprWaterUrb2005ONY",
                   "ImpWatRur2005ONY", "FLFPR2005", "PctPop0142005", "PctPop65Pl2005")],
                  fast=TRUE) 
summary_table
```

Question 4 Regress LEBF on HXPC - Report the coefficients, standard errors, confidence
intervals, p-values, R^2 and sample size in a regression table - Interperet the table, 
noting the economic and statistical significance of the relationship
What is the association between a 1,000 unit increase in GDPPC and LEBF
```{r first regression}
first_regression <- lm(LEBF20052~HXPC2005, Dataset1)
Regression_table1 <- msummary(first_regression, 
                              stars=c('*' = .1, '**' = .05, '***' = .01))         
Regression_table1
```


```{r second regression}
second_regression <- lm(LEBF20052~GDPPCUS2005, Dataset1)
Regression_table2 <- msummary(list(first_regression, second_regression),
                              stars=c('*' = .1, '**' = .05, '***' = .01),
                              fmt = 5)
        
Regression_table2 
```
the second regression shows the effect of GDPPC on LEBF. If there is a 1000 unit increase
in GDPPC then the would be a a 0.37 unit increase in the life expectancy at birth for females





Question 5 - Regress LEBF on HXPC and GDPPC - Discuss the results of this regression relative
to those from Question 4
```{r third regression}

third_regression <- lm(LEBF20052~HXPC2005+GDPPCUS2005, Dataset1)
Regression_table3 <- msummary(list(first_regression,second_regression,third_regression), 
                              stars=c('*' = .1, '**' = .05, '***' = .01),
                              fmt = 5)
Regression_table3
```
When controlling for GDPPC, the relationship between HXPC and LEBF is not statistically significant. Comparing this relationship with the results from (4), HXPC was significantly associated with a positive increase in LEBF, which makes sense that the current output is not statistically significant as we would expect an increase in health expenditure to be associated with an increase in life expectancy.
When controlling for HXPC, GDPPC is associated with a 0.005 increase in LEBF. Compared with results from (4), controlling for health expenditure slightly increases the magnitude of association between GDPPC and LEBF.



Question 6 - Do you recommend a nonlinear transformation for either GDPPC, HXPC, or LEBF? If so, defend your choice and repeat the regression in (5) with the appropriate transformations. Interpret how your results have changed. [10 points]
```{r Question No.6}

# Visually, look and see how well the observations fit the linear model

ggplot(Dataset1, aes(x = HXPC2005, y = LEBF20052)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red")

ggplot(Dataset1, aes(x = GDPPCUS2005, y = LEBF20052)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red")

# model does not fit observations well at all. for HXPC and LEBF, the majority of the observations are centred around 1
# We can also use goodness of fit (R^2) to check and see if our model is fitting the data
# R^2 from question 4 shows that R^2 between HXPC and lEBF is 0.203 and R^2 between GDPPC and LEBF is 0.256 numerically indicating that the fit can likely be improved.



```



Question 7 - How might these results differ by geography? Create a variable that assigns each observation to a geographic region (e.g., continent) and report a regression that builds on (6) by including the appropriate dummy variables. Interpret your results.
```{r Question No.7}

```


Question 8 - Finally, include an interaction term between HXPC and the indicator for African countries. What are you measuring with this interaction, and why might it be meaningful? Interpret the results of this coefficient. 
```{r Quesiton No.8}

```


Question 9 - Why is establishing the causal relationship between GDDPC, HXPC, and LEBF difficult in a simple regression such as this? If possible, provide one key figure that highlights an identification problem in this scenario.
```{r Question No.9}

```



Question 10 - What do your results from (9) and intuition suggest about the standard errors in your specification? Either justify the use of homoscedastic standard errors or implement a full specification with another, more robust method (e.g., heteroskedasticity-robust or clustered SEs). How does this change the results?
```{r Question No.10}

```


```{r Citations, include=FALSE}
knitr::write_bib(file = 'packages.bib') # Constructs a citation file for all packages used in this lecture. 

```




